{% load compressed %}
<!doctype html>
<html>
    <head>
        <meta name="google-site-verification" content="KKMUdX_TFC0dy0XA-Tb_HPjaiGLu8OJbOqdDXcCgV48" />
        {% block head %}
            <meta name="csrf-token" content="{{csrf_token}}">
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

            <title>{% block title %}{% endblock %}</title>
            <meta name="viewport" content="width=device-width">
            {% compressed_css 'global' %}
        {% endblock head %}
    </head>
    <body>
        {% block topbar %}
        <div class="navbar navbar-default navbar-static-top" role="navigation">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="{% url 'landing' %}">Airbitz</a>
                </div>
                <div class="navbar-collapse collapse">
                    <form name="search" class="navbar-form navbar-left" role="search" method="get" action="{% url 'search' %}">
                        <div class="form-group">
                            <input id="term" name="term" type="text" style="width: 200px" placeholder="Business name..." autocomplete="off"  class="typeahead form-control">
                        </div>
                        <div class="form-group">
                            <input id="near" name="near" type="text" style="width: 200px" placeholder="City..." autocomplete="off" class="typeahead form-control" value="{{ near }}">
                        </div>
                        <button type="submit" class="btn"><span class="glyphicon glyphicon-search"></span></button>
                    </form>
                </div><!--/.navbar-collapse -->
            </div>
        </div>
        {% endblock %}

        <div id="wrap">
            <div class="container">
                {% block message %}
                    {% if messages %}
                        <div class="row">
                            {% for message in messages %}
                                <li{% if message.tags %} class="alert {{ message.tags }}"{% endif %}>{{ message }}</li>
                            {% endfor %}
                        </div>
                    {% endif %}
                {% endblock message %}

                {% block body %}
                {% endblock %}
            </div><!-- /.container -->
        </div><!-- /#wrap -->

        {% block footer %}
            <div class="footer">
                <p class="text-center">
                    &copy; {% now "Y" %} - AirBitz&nbsp;
                </p>
            </div>
        {% endblock %}

        {% block javascript_headers %}
            {% compressed_js 'core' %}
        {% endblock javascript_headers %}
        {% block javascript %}
            <script type="text/javascript">
                $(function() {
                    $("form[name='search']").submit(function() {
                        var geo = AB.Geo.latestLocation();
                        if (geo) {
                            var lat = $("<input>")
                                        .attr("type", "hidden")
                                        .attr("name", "lat").val(geo.coords.latitude);
                            var lon = $("<input>")
                                        .attr("type", "hidden")
                                        .attr("name", "lon").val(geo.coords.longitude);
                            $(this).append($(lat));
                            $(this).append($(lon));
                        }
                        return true;
                    });
                    AB.addLocationSearch($('#near'));
                    AB.addPlaceSearch($('#term'));
                    // AB.Geo.requestLocation();
                });
            </script>
        {% endblock javascript %}
    </body>
</html>

