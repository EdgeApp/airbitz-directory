function supports_html5_storage(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}function getMapMarkerContent(e,t){var n='<div class="map-marker-popup"><div class="map-marker-image"><a href="'+t.url+'">'+t.img+'</a></div><div class="map-marker-info single-line"><div class="map-marker-name">'+t.name+'</div><div class="map-marker-address">'+t.address+'</div><div class="map-marker-links"><a href="'+t.url+'">View Listing</a> | <a href="'+t.directions_url+'" target="_blank">Get Directions</a></div></div><div class="map-marker-categories">'+t.cats+"</div></div>";return n}(function(){var e=this,t=e.AB={};t.geoTimeout=36e5,t.now=function(){return(new Date).getTime()},t.setLL=function(){var e=t.Geo.latestLocation(),n=$("#ll");if(e&&e.coords){var o=e.coords.latitude+","+e.coords.longitude;n.length?n.val(o):$("<input>").attr("type","hidden").attr("name","ll").attr("id","ll").attr("value",o).appendTo("#navbar-search")}else n.remove()},t.setNear=function(){t.Geo.latestLocation()?t.setLL():t.Geo.requestLocation(function(e){t.setLL(),$.getJSON("/api/v1/location-suggest/?ll="+ll).done(function(e){e&&e.near&&$("input.location").val(e.near)})})},t.setup=function(){t.setNear(),$.ajaxSetup({crossDomain:!1,beforeSend:function(e,n){t.Util.csrfSafeMethod(n.type)||e.setRequestHeader("X-CSRFToken",$('meta[name="csrf-token"]').attr("content")),e.setRequestHeader("Authorization","Token 0ccff150ed4633136f04eab2d8454d928e6ff584")}})},t.addMap=function(e,t,n,o,a,i){function r(){var r={center:new google.maps.LatLng(n,o),zoom:t,maxZoom:16,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.ROADMAP},l=new google.maps.LatLngBounds,s,u=new google.maps.Map(e[0],r),c=new google.maps.InfoWindow;if($.each(a,function(e,t){if(t.lat&&t.lon){var n=new google.maps.LatLng(t.lat,t.lon),o=new google.maps.Marker({position:n,map:u,title:t.name,animation:google.maps.Animation.DROP}),a=t;google.maps.event.addListener(o,"click",function(e){c.setContent(getMapMarkerContent(this,a)),c.open(u,this)}),google.maps.event.addListener(o,"mouseover",function(e){c.setContent(getMapMarkerContent(this,a)),c.open(u,this)}),l.extend(n)}}),i){for(var p=[],d=0;d<i.length;++d){var m=i[d];if(m.lat&&m.lon){var f=new google.maps.LatLng(m.lat,m.lon);p.push(f)}}s=new google.maps.Polygon({paths:p,strokeColor:"#003399",strokeOpacity:.25,strokeWeight:2,fillColor:"#336699",fillOpacity:.15}),s.setMap(u)}a&&a.length>1&&(u.fitBounds(l),u.panToBounds(l))}google.maps.event.addDomListener(window,"load",r)},t.addPlaceSearch=function(e){var t=$("input.location").val()||"",n=new Bloodhound({name:"business",datumTokenizer:function(e){return e},queryTokenizer:Bloodhound.tokenizers.whitespace,minLength:0,limit:10,prefetch:{url:"/api/v1/autocomplete-business/?location="+encodeURIComponent(t),filter:function(e){var t=$.map(e.results,function(e,t){return{type:e.type,name:e.text,value:e.text}});return t}},remote:{url:"/api/v1/autocomplete-business/?term=%QUERY",replace:function(e,n){return q=e.replace(/%QUERY/,n),$("input.location").val()&&(q+="&location="+encodeURIComponent(t)),q},filter:function(e){return $.map(e.results,function(e,t){return{type:e.type,name:e.text,value:e.text,id:e.bizId}})},rateLimitWait:100}});n.initialize(),e.typeahead({minLength:0,hint:!1,highlight:!0},{minLength:0,displaykey:"name",name:"business",source:n.ttAdapter(),template:function(e){return"<p>"+e.name+"</p>"}}),e.on("typeahead:selected",function(e,t){"business"===t.type&&t.id&&(location.href="/biz/"+t.id)}),e.click(function(){$(this).select()})},t.addLocationSearch=function(e,n){var o=["On the Web","Current Location"],a="";$.each(o,function(e){return a+=e+" "});var i=new Bloodhound({datumTokenizer:function(e){return a.split(/\s+/)},queryTokenizer:function(e){return a.split(/\s+/)},local:$.map(o,function(e){return{text:e,value:e}})});i.initialize();var r=function(e){return e.results.map(function(e,t){return{text:e,value:e}})},l=new Bloodhound({datumTokenizer:function(e){return e},queryTokenizer:Bloodhound.tokenizers.whitespace,minLength:0,prefetch:{url:"/api/v1/autocomplete-location/",filter:r},remote:{url:"/api/v1/autocomplete-location/?term=%QUERY",filter:r,rateLimitWait:100}});l.initialize(),e.typeahead({minLength:0,hint:!1,highlight:!0},[{displaykey:"text",name:"always",source:i.ttAdapter(),templates:function(e){return e.text}},{displaykey:"text",name:"location",source:l.ttAdapter(),templates:function(e){return e.text}}]);var s=function(){$("input.term").typeahead("destroy"),t.addPlaceSearch($("input.term"))};e.on("typeahead:selected",function(e,t){$(this).val(t.text),s()}),e.click(function(){$(this).select()}),e.change(s),e.blur(s)};var n=t.Geo={latestLocation:function(){var e=o.getCookie("geo");try{var t=JSON.parse(e)}catch(n){console.log(n)}return t},requestLocation:function(e){var n=new Date,o=this.latestLocation();if(o)try{var a=new Date(o.timestamp).getTime();if(n-a<t.geoTimeout)return}catch(i){console.log(i)}var r=this,n=t.now(),a=t.Util.getCookie("geo_timestamp");if(navigator.geolocation&&(null==a||n-a>t.geoTimeout)){var l={enableHighAccuracy:!0,timeout:5e3,maximumAge:0};t.Util.setCookie("geo_timestamp",t.now(),1),navigator.geolocation.getCurrentPosition(function(t){r.postPosition(t,e)},function(e){},l)}},postPosition:function(e,t){o.setCookie("geo",JSON.stringify(e),1),t(e)}},o=t.Util={csrfSafeMethod:function(e){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(e)},setCookie:function(e,t,n){var o=new Date;o.setDate(o.getDate()+n);var a=escape(t)+(null===n?"":"; expires="+o.toUTCString());document.cookie=e+"="+a},getCookie:function(e){var t=document.cookie,n=t.indexOf(" "+e+"=");if(-1==n&&(n=t.indexOf(e+"=")),-1==n)t=null;else{n=t.indexOf("=",n)+1;var o=t.indexOf(";",n);-1==o&&(o=t.length),t=unescape(t.substring(n,o))}return t}}}).call(this);