function initializePlaceAutocomplete(){autocomplete=new google.maps.places.Autocomplete(document.getElementById("autocomplete"),{types:["geocode","establishment"]}),google.maps.event.addListener(autocomplete,"place_changed",function(){fillInAddress()}),document.getElementById("undoAutocomplete")&&document.getElementById("undoAutocomplete").addEventListener("click",function(){inputsUndo()},!1),document.getElementById("lookupName")&&document.getElementById("lookupName").addEventListener("click",function(){lookupName()},!1)}function formatStreetAddress(e){return e[0]&&e[1]?e[0]+" "+e[1]:e[1]?e[1]:void 0}function formatCounty(e){if(e)switch(e){case"Orange County":return e;default:return e.split(" County")[0]}return e}function formatCountry(e){if(e)switch(e){case"GB":return"UK";default:return e}}function activateUpdateButtons(e){$(".updateWithOrigValue").on("click",function(e){e.preventDefault(),console.log(this.getAttribute("data-orig-value")),$(this).siblings("input").val(this.getAttribute("data-orig-value"))}),$(".updateWithNewValue").on("click",function(e){e.preventDefault(),console.log(this.getAttribute("data-new-value")),$(this).siblings("input").val(this.getAttribute("data-new-value"))})}function setInputValue(e,t){var n="input"+e.toTitleCase();if(document.getElementById(n)&&(e=n),document.getElementById(e)){var o=document.getElementById(e),a=o.value;if("undefined"==typeof t&&(t=""),a==t)return!0;$("#"+e).parent().append('<button class="updateButton updateWithOrigValue btn btn-primary btn-xs" data-orig-value="'+a+'"><i class="fa fa-refresh"></i> '+a+"</button>"),$("#"+e).parent().append('<button class="updateButton updateWithNewValue btn btn-success btn-xs" data-new-value="'+t+'"><i class="fa fa-google-plus"></i> '+t+"</button>"),activateUpdateButtons("#"+e),o.value=t,o.className+=" updated-field",$(".updated-field").removeClass("undo-field"),$(".updated-field").on("focus",function(){$(this).removeClass("updated-field")})}else console.log("setInputValue() failed to set value. Cannot find element: #"+e+" or "+n)}function lookupName(){document.getElementById("autocomplete").value=document.getElementById("name").value}function inputsUndo(){for(var e=0;e<Object.keys(origInputValues).length;e++){var t=Object.keys(origInputValues)[e];document.getElementById(t).value=origInputValues[t]}document.getElementById("autocomplete").value="",$(".updated-field").removeClass("updated-field")}function holdInputForUndo(e){var t=document.getElementById(e);if(t){var n=t.value;origInputValues[e]=n}}function holdInputsForUndo(){holdInputForUndo("address"),holdInputForUndo("admin3_name"),holdInputForUndo("admin2_name"),holdInputForUndo("admin1_code"),holdInputForUndo("postalcode"),holdInputForUndo("country"),holdInputForUndo("latitude"),holdInputForUndo("longitude"),holdInputForUndo("phone")}function fillInAddress(){$("button.updateButton").remove();var e=autocomplete.getPlace(),t=[],n,o,a,l,d,u,r,s,i,m;console.log(e);for(var c in componentForm)document.getElementById(c)&&(document.getElementById(c).value="",document.getElementById(c).disabled=!1);for(var p=0;p<e.address_components.length;p++){var g=e.address_components[p].types[0];if("street_number"==g&&(t[0]=e.address_components[p][componentForm[g]]),"route"==g&&(t[1]=e.address_components[p][componentForm[g]]),"locality"==g&&(n=e.address_components[p][componentForm[g]]),"administrative_area_level_2"==g&&(o=e.address_components[p][componentForm[g]]),"administrative_area_level_1"==g&&(a=e.address_components[p][componentForm[g]]),"postal_code"==g&&(l=e.address_components[p][componentForm[g]]),"country"==g&&(d=e.address_components[p][componentForm[g]]),componentForm[g]&&document.getElementById(g)){var f=e.address_components[p][componentForm[g]];document.getElementById(g).value=f}}holdInputsForUndo(),e.formatted_phone_number&&(s=e.international_phone_number),setInputValue("address",formatStreetAddress(t)),setInputValue("admin3_name",n),setInputValue("admin2_name",formatCounty(o)),setInputValue("admin1_code",a),setInputValue("postalcode",l),setInputValue("country",formatCountry(d)),setInputValue("latitude",e.geometry.location.lat().toFixed(7)),setInputValue("longitude",e.geometry.location.lng().toFixed(7)),setInputValue("phone",s),setInputValue("name",e.name),setInputValue("website",e.website),setInputValue("googlePlusUrl",e.url),updateLatLng()}function updateLatLng(){var e=$("#latitude").val(),t=$("#longitude").val();$("#latlng").val(e+","+t)}String.prototype.toTitleCase=function(){return this.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1)})},initializePlaceAutocomplete();var autocomplete,origInputValues={},componentForm={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"short_name",administrative_area_level_2:"short_name",country:"short_name",postal_code:"short_name"};$("#latitude, #longitude").on("change",function(){updateLatLng()}),$(".geocode-latlon").click(function(e){var t=$("#latitude").val(),n=$("#longitude").val(),o=new google.maps.LatLng(t,n),a=new google.maps.Geocoder;return a.geocode({latLng:o},function(e,t){if("OK"===t&&e){for(var n=[],o=0;o<e.length;o++){var a=e[o].types[0];if("street_address"==a){n[0]=e[o].address_components[0].types[0],n[1]=e[o].address_components[1].long_name;for(var l=0;l<e[o].address_components.length;l++){var d=e[o].address_components[l],a=d.types[0];"street_number"==a&&(n[0]=d[componentForm[a]]),"route"==a&&(n[1]=d[componentForm[a]]),"locality"==a&&(admin3_name=d[componentForm[a]]),"administrative_area_level_2"==a&&(admin2_name=d[componentForm[a]]),"administrative_area_level_1"==a&&(admin1_code=d[componentForm[a]]),"postal_code"==a&&(postalcode=d[componentForm[a]]),"country"==a&&(country=d[componentForm[a]])}}}holdInputsForUndo(),setInputValue("address",formatStreetAddress(n)),setInputValue("admin3_name",admin3_name),setInputValue("admin2_name",formatCounty(admin2_name)),setInputValue("admin1_code",admin1_code),setInputValue("postalcode",postalcode),setInputValue("country",country)}}),e.preventDefault(),!1}),$(".geocode-address").click(function(e){var t=$(this),n=t.html(),o=$("#address").val(),a=$("#admin3_name").val(),l=$("#admin1_code").val(),d=$("#postalcode").val(),t=jQuery(this);if(!(o&&a&&l&&d))return alert("Missing address fields. Unable to geocode address."),!1;var o=o+","+a+","+l+","+d,u=new google.maps.Geocoder;return u.geocode({address:o},function(e,a){if(a==google.maps.GeocoderStatus.OK){var l=e[0].geometry;latestResult=e[0];var d=latestResult.geometry.location;console.log(d),$("#latitude").val(d.lat().toFixed(7)),$("#longitude").val(d.lng().toFixed(7)),updateLatLng()}else alert("Unable to find lat/lon from "+o);t.html(n)}),e.preventDefault(),!1});