function initializePlaceAutocomplete(){autocomplete=new google.maps.places.Autocomplete(document.getElementById("autocomplete"),{types:["geocode","establishment"]}),google.maps.event.addListener(autocomplete,"place_changed",function(){fillInAddress()}),document.getElementById("undoAutocomplete")&&document.getElementById("undoAutocomplete").addEventListener("click",function(){inputsUndo()},!1),document.getElementById("lookupName")&&document.getElementById("lookupName").addEventListener("click",function(){lookupName()},!1)}function formatStreetAddress(e){return e[0]&&e[1]?e[0]+" "+e[1]:e[1]?e[1]:void 0}function formatCounty(e){if(e)switch(e){case"Orange County":return e;default:return e.split(" County")[0]}return e}function formatCountry(e){if(e)switch(e){case"GB":return"UK";default:return e}}function formatFieldValue(e,t){switch(console.log("FORMATTING "+e+":"+t+" ="),e){case"address":return console.log(formatStreetAddress(t)),formatStreetAddress(t);case"county":return console.log(formatCounty(t)),formatCounty(t);case"country":return console.log(formatCountry(t)),formatCountry(t);default:return t}}function activateUpdateButtons(e){$(".updateWithOrigValue").on("click",function(e){e.preventDefault(),console.log(this.getAttribute("data-orig-value")),$(this).siblings("input").val(this.getAttribute("data-orig-value"))}),$(".updateWithNewValue").on("click",function(e){e.preventDefault(),console.log(this.getAttribute("data-new-value")),$(this).siblings("input").val(this.getAttribute("data-new-value"))})}function setInputValue(e,t){var o="input"+e.toTitleCase();if(document.getElementById(o)&&(e=o),document.getElementById(e)){var n=document.getElementById(e),a=n.value;if(console.log("*ORIG "+e+": "+a),"undefined"==typeof t&&(t=""),a==t)return!0;$("#"+e).parent().append('<button class="updateButton updateWithOrigValue btn btn-primary btn-xs" data-orig-value="'+a+'"><i class="fa fa-refresh"></i> '+a+"</button>"),$("#"+e).parent().append('<button class="updateButton updateWithNewValue btn btn-success btn-xs" data-new-value="'+t+'"><i class="fa fa-google-plus"></i> '+t+"</button>"),activateUpdateButtons("#"+e),n.value=t,n.className+=" updated-field",$(".updated-field").removeClass("undo-field"),$(".updated-field").on("focus",function(){$(this).removeClass("updated-field")})}else console.log("setInputValue() failed to set value. Cannot find element: #"+e+" or "+o)}function checkOrigValue(e){var t=document.getElementById(e),o=t.value;console.log("ORIG "+e+": "+o)}function lookupName(){document.getElementById("autocomplete").value=document.getElementById("name").value}function inputsUndo(){for(var e=0;e<Object.keys(origInputValues).length;e++){var t=Object.keys(origInputValues)[e];document.getElementById(t).value=origInputValues[t]}document.getElementById("autocomplete").value="",$(".updated-field").removeClass("updated-field")}function holdInputForUndo(e){var t=document.getElementById(e);if(t){var o=t.value;origInputValues[e]=o}}function holdInputsForUndo(){holdInputForUndo("address"),holdInputForUndo("admin3_name"),holdInputForUndo("admin2_name"),holdInputForUndo("admin1_code"),holdInputForUndo("postalcode"),holdInputForUndo("country"),holdInputForUndo("latitude"),holdInputForUndo("longitude"),holdInputForUndo("phone")}function fillInAddress(){holdInputsForUndo(),$("button.updateButton").remove();var e=autocomplete.getPlace(),t=[],o,n,a,l,u,d,r,s,i,c;console.log(e);for(var m=0;m<e.address_components.length;m++){var p=e.address_components[m].types[0];if("street_number"==p&&(t[0]=e.address_components[m][componentForm[p]]),"route"==p&&(t[1]=e.address_components[m][componentForm[p]]),"locality"==p&&(o=e.address_components[m][componentForm[p]]),"administrative_area_level_2"==p&&(n=e.address_components[m][componentForm[p]]),"administrative_area_level_1"==p&&(a=e.address_components[m][componentForm[p]]),"postal_code"==p&&(l=e.address_components[m][componentForm[p]]),"country"==p&&(u=e.address_components[m][componentForm[p]]),componentForm[p]&&document.getElementById(p)){var g=e.address_components[m][componentForm[p]];setInputValue(p,g)}}e.formatted_phone_number&&(s=e.international_phone_number),setInputValue("address",formatFieldValue("address",t)),setInputValue("admin3_name",o),setInputValue("admin2_name",formatFieldValue("county",n)),setInputValue("admin1_code",a),setInputValue("postalcode",l),setInputValue("country",formatFieldValue("country",u)),setInputValue("latitude",e.geometry.location.lat().toFixed(7)),setInputValue("longitude",e.geometry.location.lng().toFixed(7)),setInputValue("phone",s),setInputValue("name",e.name),setInputValue("website",e.website),setInputValue("googlePlusUrl",e.url),updateLatLng()}function updateLatLng(){var e=$("#latitude").val(),t=$("#longitude").val();$("#latlng").val(e+","+t)}String.prototype.toTitleCase=function(){return this.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1)})},initializePlaceAutocomplete();var autocomplete,origInputValues={},componentForm={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"short_name",administrative_area_level_2:"short_name",country:"short_name",postal_code:"short_name"};$("#latitude, #longitude").on("change",function(){updateLatLng()}),$(".geocode-latlon").click(function(e){var t=$("#latitude").val(),o=$("#longitude").val(),n=new google.maps.LatLng(t,o),a=new google.maps.Geocoder;return a.geocode({latLng:n},function(e,t){if("OK"===t&&e){for(var o=[],n=0;n<e.length;n++){var a=e[n].types[0];if("street_address"==a){o[0]=e[n].address_components[0].types[0],o[1]=e[n].address_components[1].long_name;for(var l=0;l<e[n].address_components.length;l++){var u=e[n].address_components[l],a=u.types[0];"street_number"==a&&(o[0]=u[componentForm[a]]),"route"==a&&(o[1]=u[componentForm[a]]),"locality"==a&&(admin3_name=u[componentForm[a]]),"administrative_area_level_2"==a&&(admin2_name=u[componentForm[a]]),"administrative_area_level_1"==a&&(admin1_code=u[componentForm[a]]),"postal_code"==a&&(postalcode=u[componentForm[a]]),"country"==a&&(country=u[componentForm[a]])}}}holdInputsForUndo(),setInputValue("address",formatFieldValue("address",o)),setInputValue("admin3_name",admin3_name),setInputValue("admin2_name",formatFieldValue("county",admin2_name)),setInputValue("admin1_code",admin1_code),setInputValue("postalcode",postalcode),setInputValue("country",country)}}),e.preventDefault(),!1}),$(".geocode-address").click(function(e){var t=$(this),o=t.html(),n=$("#address").val(),a=$("#admin3_name").val(),l=$("#admin1_code").val(),u=$("#postalcode").val(),t=jQuery(this);if(!(n&&a&&l&&u))return alert("Missing address fields. Unable to geocode address."),!1;var n=n+","+a+","+l+","+u,d=new google.maps.Geocoder;return d.geocode({address:n},function(e,a){if(a==google.maps.GeocoderStatus.OK){var l=e[0].geometry;latestResult=e[0];var u=latestResult.geometry.location;console.log(u),$("#latitude").val(u.lat().toFixed(7)),$("#longitude").val(u.lng().toFixed(7)),updateLatLng()}else alert("Unable to find lat/lon from "+n);t.html(o)}),e.preventDefault(),!1});